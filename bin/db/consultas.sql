
/*Busqueda y filtrado*/
CREATE OR REPLACE FUNCTION FILTER_COMPANY(
    P_NAME VARCHAR,
    P_TYPE VARCHAR,
    P_COUNTRY VARCHAR,
    P_NIF VARCHAR
) RETURN SYS_REFCURSOR IS
    CUR SYS_REFCURSOR;
BEGIN
OPEN CUR FOR
SELECT *
FROM COMPANY
WHERE (P_NAME IS NULL OR NAME = P_NAME)
  AND (P_TYPE IS NULL OR TYPE = P_TYPE)
  AND (P_COUNTRY IS NULL OR COUNTRY = P_COUNTRY)
  AND (P_NIF IS NULL OR NIF = P_NIF);

RETURN CUR;
END;
/

/*Busqueda y filtrado traducido a MySQL*/
DELIMITER //
CREATE FUNCTION FILTER_COMPANY(
    P_NAME VARCHAR(255),
    P_TYPE VARCHAR(255),
    P_COUNTRY VARCHAR(255),
    P_NIF VARCHAR(10)
)
    RETURNS BOOLEAN
BEGIN
    DECLARE FILTER BOOLEAN;

    SET FILTER = FALSE;

    IF P_NAME IS NOT NULL THEN
    IF P_NAME = NAME THEN
    SET FILTER = TRUE;
END IF;
END IF;

IF P_TYPE IS NOT NULL THEN
        IF P_TYPE = TYPE THEN
SET FILTER = TRUE;
END IF;
END IF;

IF P_COUNTRY IS NOT NULL THEN
        IF P_COUNTRY = COUNTRY THEN
SET FILTER = TRUE;
END IF;
END IF;

IF P_NIF IS NOT NULL THEN
        IF P_NIF = NIF THEN
SET FILTER = TRUE;
END IF;
END IF;

RETURN FILTER;
END;
//
DELIMITER ;



/*Introducir empresas nuevas*/
CREATE OR REPLACE FUNCTION INSERT_EMPRESA(
    P_NIF VARCHAR(10),
    P_NOMBRE VARCHAR(12),
    P_TIPO VARCHAR(15),
    P_PAIS VARCHAR(20),
    P_DIRECCION VARCHAR(50),
    P_TELEFONO VARCHAR(12),
    P_EMAIL VARCHAR(30)
)
    RETURN VOID AS $$;
BEGIN
    INSERT INTO COMPANY (NIF, NAME, TYPE, COUNTRY, ADDRESS, PHONE, EMAIL)
    VALUES (P_NIF, P_NOMBRE, P_TIPO, P_PAIS, P_DIRECCION, P_TELEFONO, P_EMAIL);
END;
$$ LANGUAGE plpgsql;

/*Introducir nuevas empresas traducido a MySQL*/
DELIMITER //
CREATE PROCEDURE INSERT_EMPRESA(
    IN P_NIF VARCHAR(10),
    IN P_NOMBRE VARCHAR(12),
    IN P_TIPO VARCHAR(15),
    IN P_PAIS VARCHAR(20),
    IN P_DIRECCION VARCHAR(50),
    IN P_TELEFONO VARCHAR(12),
    IN P_EMAIL VARCHAR(30)
)
RETURN VOID
BEGIN
    INSERT INTO COMPANY (NIF, NAME, TYPE, COUNTRY, ADDRESS, PHONE, EMAIL)
    VALUES (P_NIF, P_NOMBRE, P_TIPO, P_PAIS, P_DIRECCION, P_TELEFONO, P_EMAIL);
END;
//
DELIMITER ;


